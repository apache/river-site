<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en">
<head>
    <!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
    -->

    <title>Apache River - Getting Started With River</title>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta property="og:image" content="//www.apache.org/images/asf_logo.gif"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link rel="stylesheet" href="/css/bootstrap.css" media="screen">
    <link rel="stylesheet" href="/css/river.css" media="screen">
    <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" media="screen">
    <script src="/js/jquery.js"></script>
    <script src="/js/bootstrap.js"></script>
    <style type="text/css">
.headerlink {
  visibility: hidden;
}
dt:hover > .headerlink, p:hover > .headerlink, td:hover > .headerlink, h1:hover > .headerlink, h2:hover > .headerlink, h3:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, h6:hover > .headerlink {
  visibility: visible
}    </style>
</head>

<body style="padding-top: 50px;">
<div class="navbar navbar-default navbar-fixed-top">
<div class="container">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                data-target="#river-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/index.html"><img src="/images/river_logo.png">Apache River&trade;</a>
    </div>

    <div class="collapse navbar-collapse" id="river-navbar-collapse">
        <ul class="nav navbar-nav">
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                   aria-expanded="false">Downloads <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="/user-doc/releases.html">Releases</a></li>
                    <li><a href="/user-doc/maven-artifacts.html">Maven artifacts</a></li>
                </ul>
            </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                   aria-expanded="false">Documentation <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="/user-doc/getting-started.html">Getting started</a></li>
                    <li><a href="/user-doc/networking.html">Networking</a></li>
                    <li><a href="/user-doc/glossary.html">Glossary</a></li>
                    <li><a href="/user-doc/cookbook.html">Cookbook</a></li>
                    <li><a href="/user-doc/supported-platforms.html">Supported platforms</a></li>
                    <li><a href="/user-doc/resources.html">Resources</a></li>
                    <li><a href="/user-doc/readings.html">Readings</a></li>
                    <li class="divider"></li>
                    <li><a href="/user-doc/specification.html">Specification</a></li>
                    <li class="divider"></li>
                    <li><a href="/release-doc/current/api/index.html">Javadoc</a></li>
                </ul>
            </li>

            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                   aria-expanded="false">Community<span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="/user-doc/get-involved.html">Get involved</a></li>
                    <li><a href="/user-doc/mailing-lists.html">Mailing lists</a></li>
                    <li><a href="/user-doc/found-a-bug.html">Found a bug</a></li>
                    <li><a href="/user-doc/people.html">People</a></li>
                    <li><a href="/user-doc/success-stories.html">Success stories</a></li>
                </ul>
            </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                   aria-expanded="false">Development <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="/dev-doc/source-code.html">Source code</a></li>
                    <li><a href="/dev-doc/development-process.html">Development process</a></li>
                    <li><a href="/dev-doc/building-river.html">Building River</a></li>
                    <li><a href="/dev-doc/ci.html">Continuous Integration</a></li>
                    <li><a href="/dev-doc/building-a-release.html">Building a release</a></li>
                    <li><a href="https://issues.apache.org/jira/browse/RIVER">Issue tracker</a></li>
                </ul>
            </li>
        </ul>

        <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                   aria-expanded="false">The Foundation <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="http://www.apache.org">Apache</a></li>
                    <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                    <li><a href="http://www.apache.org/foundation/sponsorship.html">Donate</a></li>
                    <li><a href="http://www.apache.org/foundation/how-it-works.html">How it
                        works</a></li>
                </ul>
            </li>
        </ul>

        <form class="navbar-form navbar-right" role="search"
              name="search" id="search" action="http://www.google.com/search" method="get">
            <input value="river.apache.org" name="sitesearch" type="hidden"/>
            <div class="form-group input-group" style="padding: 6px">
                <input type="text" name="q" id="query" placeholder="Google custom search" class="form-control input-sm">
                <span class="input-group-btn">
    <button type="submit" class="btn btn-default btn-sx btn-sm">
        <i class="glyphicon glyphicon-search" style="width: 15; height: 17"></i>
    </button>
    </span>
            </div>
        </form>

    </div>
</div>
</div>


<div class="container">
    <div class="space-lg"></div>
    <div class="clear"></div>
    <div id="content">
    <h3 id="getting-started-with-river">Getting Started With River<a class="headerlink" href="#getting-started-with-river" title="Permalink">&para;</a></h3>
<p>This document is going to explain how you can use the in-built "simple" services that come with River.  More specifically:</p>
<ul>
<li>a Lookup Service, the "reggie" implementation</li>
<li>a JavaSpace, the "outrigger" implementation</li>
<li>a Transaction Service, the "mahalo" implementation</li>
</ul>
<p>The instructions assume that you're building from source as checked out from the SVN trunk.  Currently this is
necessary because the code snippets below use methods and classes which, at time of writing, haven't made it into
the latest binary release yet.  Having said that, the code you will need in the binary release isn't to far removed
from what you'll see below, so you can progress with the binary release if you want to and are happy odifying the code.</p>
<p>If you are going to use the latest release then you will still need to download (from the SVN trunk) some of the
Windows BAT files mentioned below.  *nix sh scripts of those same batch files will appear shortly.</p>
<div class="panel panel-default">
<div class="panel-heading">Environment Setup</div>
<div class="panel-body">
<p>The following instructions all assume that you have checked out River to some directory which is throughout referred
to as <code>$RIVER_HOME</code>.  Further, you have changed directory into <code>$RIVER_HOME/examples/hello</code>.</p>
<div class="alert alert-info">
<p>Run all scripts from the <code>hello</code> directory</p>
</div>
<ul>
<li>Change directory to $RIVER_HOME</li>
<li>Use Ant to build River, i.e. <code>ant all.build</code></li>
</ul>
<h4 id="running-code-which-uses-river-services">Running Code Which Uses River Services<a class="headerlink" href="#running-code-which-uses-river-services" title="Permalink">&para;</a></h4>
<p>Since River uses dynamic code downloading, we need to grant various permissions to our JVM to allow that.  In the
interest of simplicity, we are going to grant everything every permission.  In the real world, this would obviously
not be recommended.</p>
<p>To grant these permissions we need to create a policy file:</p>
<pre><code>grant  { 
	permission java.security.AllPermission; 
}; 
</code></pre>
<p>Create the above file and save it somewhere that it can be easily referenced as a command line argument to some Java
you're going to write - such as the working directory that you will run the code from.</p>
<p>Further, your programs which will use River services will need the following JVM arguments.</p>
<pre><code>-Djava.security.policy=path/to/policy.all
-Djava.rmi.server.RMIClassLoaderSpi=net.jini.loader.pref.PreferredClassProvider
</code></pre>
<p>Also, before doing anything with any River code you need to set an appropriate security manager.  This needs to be
done only once per program.</p>
<pre><code>System.setSecurityManager(new RMISecurityManager());
</code></pre>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">Starting the HTTP server</div>
<div class="panel-body">
<h4 id="what-wait-why-do-i-need-to-do-that">What?  Wait, why do I need to do that?<a class="headerlink" href="#what-wait-why-do-i-need-to-do-that" title="Permalink">&para;</a></h4>
<p>When services get marshalled for sending over the wire, the first part of their stream is the codebase URL.  This URL
tells the downloading JVM where to load the supporting JARs from.  Often (although not always) in the River/Jini world
this code base harks back to some HTTP server.  There is a simple HTPP server packaged inside River which can be used
for this.  That's what we're going to start.</p>
<p>See <a href="http://download.oracle.com/javase/1.5.0/docs/guide/rmi/codebase.html">3.2 How codebase is used in Java RMI</a> for
more details.</p>
<div class="alert alert-info">
<ul>
<li>Change to directory to <code>$RIVER_HOME/examples/hello/</code> <br/></li>
<li>Execute the script; <code>scripts/httpd.bat</code> <br/></li>
</ul>
</div>
<h4 id="testing-it">Testing it<a class="headerlink" href="#testing-it" title="Permalink">&para;</a></h4>
<p>To test that the HTTP server is running correctly use wget or your web browser on the following URL</p>
<ul>
<li><a href="http://localhost:8080/reggie-dl.jar">http://localhost:8080/reggie-dl.jar</a></li>
</ul>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">Starting a Service Registrar (Lookup Service)</div>
<div class="panel-body">
<h5>What?  Wait, why do I need to do that?</h5>
<p>Typically, in an environment which uses River/Jini services, a Lookup Service will be used.  This Lookup Service is
then used by your code to find River/Jini services.  Lookup Services always know the current state of the subnet or
federated space.</p>
<p>Broadly speaking (although not 100% accurately) you need a Lookup Service in order to be able to find other services to use.</p>
<div class="alert alert-info">
<ul>
<li>Change to directory to <code>$RIVER_HOME/examples/hello/</code> <br/></li>
<li>Execute the script; <code>scripts/jrmp-reggie.bat</code> <br/></li>
</ul>
</div>
<h5>Testing it</h5>
<p>There are two ways to find our Lookup Service.  Remember that the interface which fulfills the role of a Lookup Service
is <code>ServiceRegistrar</code>.</p>
<h5>Unicast</h5>
<p>If we know where our Lookup Service is running, we can use unicast to connect straight to it.</p>
<pre><code>:::java
LookupLocator ll = new LookupLocator("jini://localhost:4160");
StreamServiceRegistrar sr = ll.getStreamRegistrar();
System.out.println("Service Registrar: " + sr.getServiceID());
</code></pre>
<p>Assuming you don't get a <code>NullPointerException</code> and you do get a service ID written out, then your Lookup Service is
running fine.</p>
<p>The <code>LookupLocator</code> takes a String representing a "jini URL".  This jini URL is made up from the Strings "<code>jini://</code>" a
hostname and (optionally) "<code>:</code>" and a port number.  4160 is the default port and is specified in the Lookup Service
configuration file.  The scripts in the  {{examples/hello}} directory will use the default port unless you have changed
it. See <a href="/release-doc/2.2.3/specs/html/discovery-spec.html">DJ.5.5 Address and Port Mappings for TCP and Multicast UDP</a>
for more details.</p>
<h5>Multicast</h5>
<p>If we know only that "some lookup services are on the subnet somewhere" then we can use multicast to find them.</p>
<pre><code>DiscoveryListenerManagement dlm = new LookupDiscovery(LookupDiscovery.ALL_GROUPS);

LeaseRenewalManager lrm = new LeaseRenewalManager();
ServiceDiscoveryManager sdm = new ServiceDiscoveryManager(dlm, lrm);

Thread.sleep(500); //need to wait a little bit for the Lookup Service to generate the events to the sdm

ServiceTemplate srTemplate = new ServiceTemplate(null, new Class[]  { ServiceRegistrar.class }, null);

ServiceItem[] sis = sdm.lookup(srTemplate, 10, null);
for (ServiceItem si : sis)  {
    System.out.println("Service Registrar: "+si.serviceID);
}

dlm.terminate();
</code></pre>
<p>This approach is slightly different.  It is relying the <code>ServiceDiscoveryManager</code> to listen to the UDP multicast
packets announcing the presence of a Lookup Service.  The same rules apply as for unicast on deciding whether or
not your Lookup Service is running.</p>
<p>This approach can be modified if you know which hosts on the subnet <em>might</em> be running lookup services.  You can
define and pass this list to the <code>LookupDiscovery</code> constructor.</p>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">Starting a Java Space</div>
<div class="panel-body">
<h5>What?  Wait, why do I need to do that?</h5>
<p>Finding a Lookup Service is only useful if there are some other services on the network which you want to use, so
now we're going to start a Java Space, and find that.  Using the Java Space is outside the scope of this document,
although the "how" is relatively straightforward.</p>
<div class="alert alert-info">
<ul>
<li>Change to directory to <code>$RIVER_HOME/examples/hello/</code> <br/></li>
<li>Execute the script; <code>scripts/jrmp-outrigger-group</code> <br/></li>
</ul>
</div>
<h5>Testing it</h5>
<p>To find any kind of service we must first create a template.
This is an instance of <code>ServiceTemplate</code> which describes the kind of thing we're
looking for.
As the Jini specification says, nulls and empty arrays as wildcard characters for
"any value".
So the following code is a template which will match any service which implements the <code>JavaSpace</code> interface regardless of the rest of it's characteristics.</p>
<pre><code>ServiceTemplate template = new ServiceTemplate(null, new Class[)  { JavaSpace.class }, new Entry[0]());
</code></pre>
<p>Using the unicast and a <code>ServiceRegistrar</code> we find the Java Space like this;</p>
<pre><code>ServiceMatches sms = sr.lookup(template, 10);
if (0 &lt; sms.items.length)  {
    JavaSpace space = (JavaSpace) sms.items[0].service;
    // do something with the space
}
else  {
    System.out.println("No Java Space found.");
}
</code></pre>
<p>Using the <code>ServiceDiscoveryManager</code> is similar;</p>
<pre><code>ServiceItem si = sdm.lookup(template, null);
if (null != si)  {
    JavaSpace space = (JavaSpace) sms.service;
    // do something with the space
}
else  {
    System.out.println("No Java Space found.");
}
</code></pre>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">Starting a Transaction Service</div>
<div class="panel-body">
<h5>What?  Wait, why do I need to do that?</h5>
<p>Because you'd like to find something that will give you a nice distributed transaction.</p>
<div class="alert alert-info">
<ul>
<li>Change to directory to <code>$RIVER_HOME/examples/hello/</code> <br/></li>
<li>Execute the script; <code>scripts/jrmp-mahalo-group</code> <br/></li>
</ul>
</div>
<h5>Testing it</h5>
<p>Testing it is done in the same way as for the Java Space.  However, the constructor of the <code>ServiceTemplate</code> changes.</p>
<pre><code>ServiceTemplate template = new ServiceTemplate(null, new Class[)  { TransactionManager.class }, new Entry[0](0.html));
</code></pre>
</div>
</div>

    </div>
    <hr>
<footer>
    <div class="container">
        <div class="row">
            <div class="col-xs-3 col-sm-1 col-md-1 col-lg-1">
                <a href="http://apache.org" target="_blank"><img src="/images/apache-logo.png" width="40%"/></a>
            </div>

            <div class="col-xs-9 col-sm-11 col-md-11 col-lg-11">
                <p>Copyright &#169; 2012-2021 <a href="http://www.apache.org/">The Apache Software Foundation</a>,
                    Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version
                        2.0</a>.
                    <br/>
                    Apache River, the Apache River logo, Apache and the Apache feather logo are trademarks of The
                    Apache Software Foundation.
                    <br/>
                    All other marks mentioned may be trademarks or registered trademarks
                    of their respective owners.
                </p>
            </div>
        </div>
    </div>
</footer></div>

<!-- tooltip delay is too long, but could not find where it is set in the theme or bootstrap -->
<script>
$(document).ready(function(){
    $('a').tooltip({delay: {show: 700, hide: 200}});
});
</script>
</body>
</html>