<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en">
<head>
    <!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
    -->

    <title>Apache River - Hello World</title>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta property="og:image" content="//www.apache.org/images/asf_logo.gif"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link rel="stylesheet" href="/css/bootstrap.css" media="screen">
    <link rel="stylesheet" href="/css/river.css" media="screen">
    <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" media="screen">
    <script src="/js/jquery.js"></script>
    <script src="/js/bootstrap.js"></script>
    <style type="text/css">
.headerlink {
  visibility: hidden;
}
dt:hover > .headerlink, p:hover > .headerlink, td:hover > .headerlink, h1:hover > .headerlink, h2:hover > .headerlink, h3:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, h6:hover > .headerlink {
  visibility: visible
}    </style>
</head>

<body style="padding-top: 50px;">
<div class="navbar navbar-default navbar-fixed-top">
<div class="container">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                data-target="#river-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/index.html"><img src="/images/river_logo.png">Apache River&trade;</a>
    </div>

    <div class="collapse navbar-collapse" id="river-navbar-collapse">
        <ul class="nav navbar-nav">
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                   aria-expanded="false">Downloads <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="/user-doc/releases.html">Releases</a></li>
                    <li><a href="/user-doc/maven-artifacts.html">Maven artifacts</a></li>
                </ul>
            </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                   aria-expanded="false">Documentation <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="/user-doc/getting-started.html">Getting started</a></li>
                    <li><a href="/user-doc/networking.html">Networking</a></li>
                    <li><a href="/user-doc/glossary.html">Glossary</a></li>
                    <li><a href="/user-doc/cookbook.html">Cookbook</a></li>
                    <li><a href="/user-doc/supported-platforms.html">Supported platforms</a></li>
                    <li><a href="/user-doc/resources.html">Resources</a></li>
                    <li><a href="/user-doc/readings.html">Readings</a></li>
                    <li class="divider"></li>
                    <li><a href="/user-doc/specification.html">Specification</a></li>
                    <li class="divider"></li>
                    <li><a href="/release-doc/current/api/index.html">Javadoc</a></li>
                </ul>
            </li>

            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                   aria-expanded="false">Community<span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="/user-doc/get-involved.html">Get involved</a></li>
                    <li><a href="/user-doc/mailing-lists.html">Mailing lists</a></li>
                    <li><a href="/user-doc/found-a-bug.html">Found a bug</a></li>
                    <li><a href="/user-doc/people.html">People</a></li>
                    <li><a href="/user-doc/success-stories.html">Success stories</a></li>
                </ul>
            </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                   aria-expanded="false">Development <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="/dev-doc/source-code.html">Source code</a></li>
                    <li><a href="/dev-doc/development-process.html">Development process</a></li>
                    <li><a href="/dev-doc/building-river.html">Building River</a></li>
                    <li><a href="/dev-doc/ci.html">Continuous Integration</a></li>
                    <li><a href="/dev-doc/building-a-release.html">Building a release</a></li>
                    <li><a href="https://issues.apache.org/jira/browse/RIVER">Issue tracker</a></li>
                </ul>
            </li>
        </ul>

        <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                   aria-expanded="false">The Foundation <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                    <li><a href="http://www.apache.org">Apache</a></li>
                    <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
                    <li><a href="http://www.apache.org/foundation/sponsorship.html">Donate</a></li>
                    <li><a href="http://www.apache.org/foundation/how-it-works.html">How it
                        works</a></li>
                </ul>
            </li>
        </ul>

        <form class="navbar-form navbar-right" role="search"
              name="search" id="search" action="http://www.google.com/search" method="get">
            <input value="river.apache.org" name="sitesearch" type="hidden"/>
            <div class="form-group input-group" style="padding: 6px">
                <input type="text" name="q" id="query" placeholder="Google custom search" class="form-control input-sm">
                <span class="input-group-btn">
    <button type="submit" class="btn btn-default btn-sx btn-sm">
        <i class="glyphicon glyphicon-search" style="width: 15; height: 17"></i>
    </button>
    </span>
            </div>
        </form>

    </div>
</div>
</div>


<div class="container">
    <div class="space-lg"></div>
    <div class="clear"></div>
    <div id="content">
    <h1 id="hello-world-with-river">Hello World With River<a class="headerlink" href="#hello-world-with-river" title="Permalink">&para;</a></h1>
<p><strong>Experimental</strong><br/>
Warning!  The following describes how to use code which is currently only contained in a branch of River and has not been formally released yet.</p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permalink">&para;</a></h2>
<p>It can be argued that part of the barrier to entry of getting working River services is the complexity and difficulty with configuring services.  The are many things that users, new and old, must remember when trying to set up new environments and tweak the configurations of their services.</p>
<p>The configurations themselves can be temperamental and difficult for new comers to get to grips with.  Largely, they are text files with a Java-esque content which is parsed by the <code>ServiceStarter</code>.  The other problem with the config files is ensuring that you can share configuration for certain services across the djinn.  Encapsulating configuration in Java code, which can be more easily humanly read, verified and shared is possibly a better idea than having many slightly different copies of configuration files which must then be kept in step.  The following describes how to use the "extra" bits of River to get around these issues.</p>
<h2 id="extra-river">Extra River<a class="headerlink" href="#extra-river" title="Permalink">&para;</a></h2>
<p>The classes required in this documentation live outside of the main River distribution, in fact they are not part of the core of the library neither are they part of the Jini and JavaSpaces specifications. In a standard River install, they are therefore completely optional.</p>
<h2 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permalink">&para;</a></h2>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink">&para;</a></h3>
<p>River Extras require the following additional JARs on their runtime classpath.</p>
<ul>
<li>Apache Commons Collections 3.2</li>
<li>Apache Commons Lang 2.6</li>
</ul>
<p>From now on, this document will refer to these two exact file system location of these JARs as;</p>
<ul>
<li><code>$  {COMMONS_COLLECTIONS_JAR}</code></li>
<li><code>$  {COMMONS_LANG_JAR}</code></li>
</ul>
<h3 id="from-binary-distribution">From Binary Distribution<a class="headerlink" href="#from-binary-distribution" title="Permalink">&para;</a></h3>
<p>Download the latest version of River and extract it to some directory.  From now on, this will be known as <code>$  {RIVER_HOME}</code></p>
<p>See the optional part of "From Source" if you also want to build and experiment with the example service.</p>
<h3 id="from-source">From Source<a class="headerlink" href="#from-source" title="Permalink">&para;</a></h3>
<p>You must first get the River source.  Since this code is still experimental, that means checking out the code from a trunk.  Ideally, this code will make the next release and so will come packaged as part of the River (source) distribution.</p>
<pre><code>
$  cd ~/projects/river
$  svn co http://svn.apache.org/repos/asf/river/jtsk/skunk/easystart helloworld
$  cd helloworld
$  ant # This will build the River distribution, including the lib/extra.jar
</code></pre>
<p>Additionally, if you want to be able to run the example code which uses this configuration technique, you must also build the JAR which contains it.  This is done by executing the following Ant command.  However, if you are only interested in using the <code>extra.jar</code> then there is no need to complete this step.</p>
<pre><code>
$  cd ../src-extra-examples
$  ant # This will build the lib/extra-examples.jar
</code></pre>
<p>From this point on, we shall refer to the installation of River as <code>$  {RIVER_HOME}</code>.  In this example, it would refer to directory <code>~/projects/river/helloworld</code>.</p>
<h3 id="starting-the-http-server">Starting the HTTP Server<a class="headerlink" href="#starting-the-http-server" title="Permalink">&para;</a></h3>
<p>Jini/River services of course require a HTTP server.  This is easily started in such a way as it will serve all the JAR files from the $  {RIVER_HOME}/lib directory.</p>
<p>Open your IDE of choice, fix any build/setup errors and then setup a run configuration for the HTTP server - I use Eclipse, hence the terminology.</p>
<p>The main class to run is, <code>org.apache.river.extra.examples.easystart.riverservices.StartHttpServer</code> and can be found in the <code>$  {RIVER_HOME}/src-extra-examples</code> source directory.  It will need the following program arguments;</p>
<ul>
<li>~/projects/river/helloworld</li>
<li>8080</li>
</ul>
<p>Obviously, the first argument is the value of <code>$  {RIVER_HOME}</code> and the second is the HTTP port to use.  This is the default port according to River Extras, if you want to use a different port then this will require changes (in Java code) of the configuration.</p>
<p>Execute this run configuration and leave it running.  You can verify that it's working correctly by using your browser or <code>wget</code> to download a sample JAR, e.g.</p>
<p><code>$  wget <a href="http://localhost:8080/reggie.jar">http://localhost:8080/reggie.jar</a></code></p>
<p>The rest of this document describes code that can be found in the <code>src-extra</code> and <code>src-extra-examples</code> source directories.</p>
<h3 id="running-services">Running Services<a class="headerlink" href="#running-services" title="Permalink">&para;</a></h3>
<p>When running River services you will also require the following VM arguments.</p>
<pre><code>
-Djava.security.policy=<em>$  {RIVER_HOME}</em>/src-extra/policy.all 
-Djava.rmi.server.RMIClassLoaderSpi=net.jini.loader.pref.PreferredClassProvider
-DRIVER_HOME=<em>$  {RIVER_HOME}</em>
</code></pre>
<p><b>Important</b>: The policy file specified above is a "grant all" policy file.  You could consider it a "disable security" security policy.  As such it is unsuitable for real-world use.</p>
<h3 id="common-service-configuration-options">Common Service Configuration Options<a class="headerlink" href="#common-service-configuration-options" title="Permalink">&para;</a></h3>
<p>We are going to use a <code>ApplicationOptions</code> to describe certain service configuration options that will be common to all the services we're going to start.  From, <code>org.apache.river.extra.examples.easystart.StartServices</code>;</p>
<code>
ApplicationOptions options = new ApplicationOptions();<br/>
options.setJiniPort(4162);<br/>
options.setHttpOptions("localhost", 8080, true);<br/>
options.addLookupGroup("extra").addLookupGroup("example");<br/>
options.setPackageName(ExampleService.PACKAGE);<br/>
</code>
<p>So you can see we are using the non-default Jini port (4162).  We are also setting the configuration package name of our services to some constant as defined in <code>ExampleService.PACKAGE</code>.</p>
<p>We shall describe <code>ExampleService</code> later.</p>
<p>Next we need a factory to build our configuration objects;</p>
<code>
ApplicationConfigurationFactory configFac = new ApplicationConfigurationFactory(options);
</code>
<p>This class extends a River Extra class, <code>org.apache.river.extra.easystart.config.ConfigurationFactory</code>.  This base class knows how to create configuration objects for the standard River services using the djinn specific options as we have described above, the extending class also knows how to create configuration objects for our additional custom services.</p>
<h3 id="starting-the-lookup-service">Starting the Lookup Service<a class="headerlink" href="#starting-the-lookup-service" title="Permalink">&para;</a></h3>
<p>Staying with the same <code>StartServices</code> class from above.</p>
<p>First we need to configure the lookup service and then we can start it.  This is easily done;</p>
<pre><code>
LookupServiceConfiguration lusConfig = configFac.lookupServiceConfig();
lusConfig.addMemberGroup("extra").addMemberGroup("example");
ServiceStarter.main(lusConfig.riverConfig());
</code></pre>
<p>Notice that we have set the lookup service's configuration's member groups to be the same as the lookup groups as defined in the <code>ApplicationOptions</code> instance above.</p>
<p>We now have a started lookup service; (but check your console for errors!)</p>
<h3 id="starting-the-example-service">Starting the Example Service<a class="headerlink" href="#starting-the-example-service" title="Permalink">&para;</a></h3>
<p>Next we need a configuration for our example service.</p>
<p>The configuration is described in our extended <code>ApplicationConfigurationFactory</code>, thus;</p>
<pre><code>
public AbstractEasyConfiguration exampleService(Name name)  {
&nbsp;&nbsp;&nbsp;&nbsp;ApplicationOptions exampleOptions = getDefaultOptions();
&nbsp;&nbsp;&nbsp;&nbsp;exampleOptions.setImplementationClass(ExampleServiceImpl.class);
&nbsp;&nbsp;&nbsp;&nbsp;exampleOptions.addInitialLookupAttribute(name);
&nbsp;&nbsp;&nbsp;&nbsp;return new AbstractEasyConfiguration(exampleOptions)  {};
}
</code></pre>
<p>Now we know how the configuration was done.  You should also be able to see how easy it will be to extend this concept of ConfigurationFactory to handle all of your own custom services that make up your own applications.</p>
<p>We can start the example service in exactly the same way as we did the lookup service previously.</p>
<code>
AbstractEasyConfiguration config = configFac.exampleService(new Name("Jeff"));
ServiceStarter.main(config.riverConfig());
</code>
<p>Now we have successfully configured and started our example service, and in all of this we did not have to bother ourselves with any configuration file.</p>
<p>It should be pointed out that the services we have started are using the default policy file which is unsuitable for a live environment, since it is a "grant all" policy file that can be found in <code>$  {RIVER_HOME}/src-extra/policy.all</code></p>
<p>So by defining and sharing our own implementation of the configuration factory we can be sure that all services started with configurations from that factory will be configured accordingly.  What's more, we no longer have to maintain series of configuration files which potential contain many duplicate data items.</p>
<h2 id="additional-configuration">Additional Configuration<a class="headerlink" href="#additional-configuration" title="Permalink">&para;</a></h2>
<p>You can specify additional configuration data by creating custom <code>org.apache.river.extra.easystart.config.settings.Setting</code> objects and adding them to the <code>org.apache.river.extra.easystart.config.ApplicationOptions</code> instance before creating your configuration factory.  In the same package, there are additional extending classes of <code>Setting</code> that can be used as templates for your own configuration options.</p>

    </div>
    <hr>
<footer>
    <div class="container">
        <div class="row">
            <div class="col-xs-3 col-sm-1 col-md-1 col-lg-1">
                <a href="http://apache.org" target="_blank"><img src="/images/apache-logo.png" width="40%"/></a>
            </div>

            <div class="col-xs-9 col-sm-11 col-md-11 col-lg-11">
                <p>Copyright &#169; 2012-2021 <a href="http://www.apache.org/">The Apache Software Foundation</a>,
                    Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version
                        2.0</a>.
                    <br/>
                    Apache River, the Apache River logo, Apache and the Apache feather logo are trademarks of The
                    Apache Software Foundation.
                    <br/>
                    All other marks mentioned may be trademarks or registered trademarks
                    of their respective owners.
                </p>
            </div>
        </div>
    </div>
</footer></div>

<!-- tooltip delay is too long, but could not find where it is set in the theme or bootstrap -->
<script>
$(document).ready(function(){
    $('a').tooltip({delay: {show: 700, hide: 200}});
});
</script>
</body>
</html>