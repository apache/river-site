<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_45) on Sun Nov 10 23:24:25 EST 2013 -->
<title>TxnMonitorTask (Apache River v2.2.2 API Documentation (internals))</title>
<meta name="date" content="2013-11-10">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="TxnMonitorTask (Apache River v2.2.2 API Documentation (internals))";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/TxnMonitorTask.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/sun/jini/outrigger/TxnMonitor.ToMonitor.html" title="class in com.sun.jini.outrigger"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../com/sun/jini/outrigger/TxnState.html" title="class in com.sun.jini.outrigger"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/sun/jini/outrigger/TxnMonitorTask.html" target="_top">Frames</a></li>
<li><a href="TxnMonitorTask.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.sun.jini.outrigger</div>
<h2 title="Class TxnMonitorTask" class="title">Class TxnMonitorTask</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li><a href="../../../../com/sun/jini/thread/RetryTask.html" title="class in com.sun.jini.thread">com.sun.jini.thread.RetryTask</a></li>
<li>
<ul class="inheritance">
<li>com.sun.jini.outrigger.TxnMonitorTask</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="../../../../com/sun/jini/constants/TimeConstants.html" title="interface in com.sun.jini.constants">TimeConstants</a>, <a href="../../../../com/sun/jini/thread/TaskManager.Task.html" title="interface in com.sun.jini.thread">TaskManager.Task</a>, <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Runnable.html?is-external=true" title="class or interface in java.lang">Runnable</a>, <a href="../../../../net/jini/core/transaction/server/TransactionConstants.html" title="interface in net.jini.core.transaction.server">TransactionConstants</a></dd>
</dl>
<hr>
<br>
<pre> class <span class="strong">TxnMonitorTask</span>
extends <a href="../../../../com/sun/jini/thread/RetryTask.html" title="class in com.sun.jini.thread">RetryTask</a>
implements <a href="../../../../net/jini/core/transaction/server/TransactionConstants.html" title="interface in net.jini.core.transaction.server">TransactionConstants</a>, <a href="../../../../com/sun/jini/constants/TimeConstants.html" title="interface in com.sun.jini.constants">TimeConstants</a></pre>
<div class="block">A task that will try to validate the state of a transaction.  This
 uses weak references a good deal to let the other parts of the system
 be GC'ed as necessary.
 <p>
 The retry mechanism is subtle, so bear with me.  The purpose is
 to ensure that if any activity is being blocked by a given
 transaction, that transaction will be tested at some point in
 the future (if necessary, i.e., if it still is thought to be
 active).  We assume it to be rare that a transactions that the
 space thinks is active is, in fact, aborted, so the algorithm is
 designed to guarantee the detection without a lot of overhead,
 specifically without a lot of RMI calls.
 <p>
 Each task has three values: a <code>nextQuery</code> time, a
 <code>mustQuery</code> boolean that force the next query to be
 made, and <code>deltaT</code>, the time at which the following
 query will be scheduled.  When the task is awakened at its
 <code>nextQuery</code> time, it checks to see if it must make an
 actual query to the transaction manager, which it will do if either
 <code>mustQuery</code> is <code>true</code>, or if we know about
 any in progress queries on the space that are blocked on the
 transaction.  Whether or not an actual query is made,
 <code>deltaT</code> is added to <code>nextQuery</code> to get the
 <code>nextQuery</code> time, <code>deltaT</code> is doubled, and
 <code>mustQuery</code> boolean is set to <code>false</code>.
 <p>
 There are two kinds of requests that a with which transaction
 can cause a conflict -- those with long timeouts (such as
 blocking reads and takes) and those that are under short timeouts
 (such as reads and takes with zero-length timeouts).  We will
 treat them separately at several points of the algorithm.  A
 short timeout is any query whose expiration time is sooner than
 the <code>nextQuery</code> time.  Any other timeout is long
 If a short query arrives, <code>mustQuery</code> is set to 
 <code>true</code>.
 <p>
 The result is that any time a transaction causes a conflict, if
 the query on the space has not ended by the time of the
 <code>nextQuery</code> we will attempt to poll the transaction manager.  
 There will also poll the transaction manager if any conflict occurred
 on a query on the space with a short timeout.
 <p>
 The first time a transaction causes a conflict, we schedule a
 time in the future at which we will poll its status.  We do not
 poll right away because often a transaction will complete on
 its own before we get to that time, making the check
 unnecessary.  An instant poll is, therefore, unnecessarily
 aggressive, since giving an initial grace time will usually mean
 no poll is made at all.  So if the first conflict occurs at
 <i>T</i><sub>0</sub>, the <code>nextQuery</code> value will be
 <i>T</i><sub>0</sub><code>+INITIAL_GRACE</code>, the boolean
 will be <code>true</code> to force that poll to happen, and
 <code>deltaT</code> will be set to <code>INITIAL_GRACE</code>.</div>
<dl><dt><span class="strong">Author:</span></dt>
  <dd>Sun Microsystems, Inc.</dd>
<dt><span class="strong">See Also:</span></dt><dd><a href="../../../../com/sun/jini/outrigger/TxnMonitor.html" title="class in com.sun.jini.outrigger"><code>TxnMonitor</code></a></dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static long</code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#BETWEEN_EXCEPTIONS">BETWEEN_EXCEPTIONS</a></strong></code>
<div class="block">The retry time when we have an encountered an exception</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private long</code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#deltaT">deltaT</a></strong></code>
<div class="block">next value added to <code>nextQuery</code></div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private int</code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#failCnt">failCnt</a></strong></code>
<div class="block">count of RemoteExceptions</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static long</code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#INITIAL_GRACE">INITIAL_GRACE</a></strong></code>
<div class="block">The initial grace period before the first query.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/logging/Logger.html?is-external=true" title="class or interface in java.util.logging">Logger</a></code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#logger">logger</a></strong></code>
<div class="block">Logger for logging transaction related information</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static long</code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#MAX_DELTA_T">MAX_DELTA_T</a></strong></code>
<div class="block">The largest value that <code>deltaT</code> will reach.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static int</code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#MAX_FAILURES">MAX_FAILURES</a></strong></code>
<div class="block">The maximum number of failures allowed in a row before we simply
 give up on the transaction and consider it aborted.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../../com/sun/jini/outrigger/TxnMonitor.html" title="class in com.sun.jini.outrigger">TxnMonitor</a></code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#monitor">monitor</a></strong></code>
<div class="block">the monitor we were made by</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#mustQuery">mustQuery</a></strong></code>
<div class="block">When we're given an opportunity to poll the transaction manager
 for the <code>txn</code>'s state, do so.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private long</code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#nextQuery">nextQuery</a></strong></code>
<div class="block">The next time we need to poll the transaction manager 
 to get <code>txn</code>'s actual state.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/Map.html?is-external=true" title="class or interface in java.util">Map</a></code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#queries">queries</a></strong></code>
<div class="block">All the queries on the space (not queries to the transaction
 manager) waiting for <code>txn</code> to be resolved.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../../com/sun/jini/outrigger/Txn.html" title="class in com.sun.jini.outrigger">Txn</a></code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#txn">txn</a></strong></code>
<div class="block">transaction being monitored</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="fields_inherited_from_class_net.jini.core.transaction.server.TransactionConstants">
<!--   -->
</a>
<h3>Fields inherited from interface&nbsp;net.jini.core.transaction.server.<a href="../../../../net/jini/core/transaction/server/TransactionConstants.html" title="interface in net.jini.core.transaction.server">TransactionConstants</a></h3>
<code><a href="../../../../net/jini/core/transaction/server/TransactionConstants.html#ABORTED">ABORTED</a>, <a href="../../../../net/jini/core/transaction/server/TransactionConstants.html#ACTIVE">ACTIVE</a>, <a href="../../../../net/jini/core/transaction/server/TransactionConstants.html#COMMITTED">COMMITTED</a>, <a href="../../../../net/jini/core/transaction/server/TransactionConstants.html#NOTCHANGED">NOTCHANGED</a>, <a href="../../../../net/jini/core/transaction/server/TransactionConstants.html#PREPARED">PREPARED</a>, <a href="../../../../net/jini/core/transaction/server/TransactionConstants.html#VOTING">VOTING</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="fields_inherited_from_class_com.sun.jini.constants.TimeConstants">
<!--   -->
</a>
<h3>Fields inherited from interface&nbsp;com.sun.jini.constants.<a href="../../../../com/sun/jini/constants/TimeConstants.html" title="interface in com.sun.jini.constants">TimeConstants</a></h3>
<code><a href="../../../../com/sun/jini/constants/TimeConstants.html#DAYS">DAYS</a>, <a href="../../../../com/sun/jini/constants/TimeConstants.html#HOURS">HOURS</a>, <a href="../../../../com/sun/jini/constants/TimeConstants.html#MINUTES">MINUTES</a>, <a href="../../../../com/sun/jini/constants/TimeConstants.html#SECONDS">SECONDS</a></code></li>
</ul>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#TxnMonitorTask(com.sun.jini.outrigger.Txn, com.sun.jini.outrigger.TxnMonitor, com.sun.jini.thread.TaskManager, com.sun.jini.thread.WakeupManager)">TxnMonitorTask</a></strong>(<a href="../../../../com/sun/jini/outrigger/Txn.html" title="class in com.sun.jini.outrigger">Txn</a>&nbsp;txn,
              <a href="../../../../com/sun/jini/outrigger/TxnMonitor.html" title="class in com.sun.jini.outrigger">TxnMonitor</a>&nbsp;monitor,
              <a href="../../../../com/sun/jini/thread/TaskManager.html" title="class in com.sun.jini.thread">TaskManager</a>&nbsp;manager,
              <a href="../../../../com/sun/jini/thread/WakeupManager.html" title="class in com.sun.jini.thread">WakeupManager</a>&nbsp;wakeupMgr)</code>
<div class="block">Create a new TxnMonitorTask.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(package private) void</code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#add(com.sun.jini.outrigger.QueryWatcher)">add</a></strong>(<a href="../../../../com/sun/jini/outrigger/QueryWatcher.html" title="class in com.sun.jini.outrigger">QueryWatcher</a>&nbsp;query)</code>
<div class="block">Add in a resource.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>(package private) void</code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#addSibling(com.sun.jini.outrigger.Txn)">addSibling</a></strong>(<a href="../../../../com/sun/jini/outrigger/Txn.html" title="class in com.sun.jini.outrigger">Txn</a>&nbsp;txn)</code>
<div class="block">Add a ``sibling'' transaction, one that is now blocking progress
 on one of the same entries.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#logUnpackingFailure(java.lang.String, java.util.logging.Level, boolean, java.lang.Throwable)">logUnpackingFailure</a></strong>(<a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;exceptionDescription,
                   <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/logging/Level.html?is-external=true" title="class or interface in java.util.logging">Level</a>&nbsp;level,
                   boolean&nbsp;terminal,
                   <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang">Throwable</a>&nbsp;t)</code>
<div class="block">Log failed unpacking attempt attempt</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#retryTime()">retryTime</a></strong>()</code>
<div class="block">Return the time of the next query, bumping <code>deltaT</code> as
 necessary for the next iteration.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#runAfter(java.util.List, int)">runAfter</a></strong>(<a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&nbsp;tasks,
        int&nbsp;size)</code>
<div class="block">We can run in parallel with any task, so just return
 <CODE>false</CODE>.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../com/sun/jini/outrigger/TxnMonitorTask.html#tryOnce()">tryOnce</a></strong>()</code>
<div class="block">Try to see if this transaction should be aborted.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_com.sun.jini.thread.RetryTask">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;com.sun.jini.thread.<a href="../../../../com/sun/jini/thread/RetryTask.html" title="class in com.sun.jini.thread">RetryTask</a></h3>
<code><a href="../../../../com/sun/jini/thread/RetryTask.html#attempt()">attempt</a>, <a href="../../../../com/sun/jini/thread/RetryTask.html#cancel()">cancel</a>, <a href="../../../../com/sun/jini/thread/RetryTask.html#cancelled()">cancelled</a>, <a href="../../../../com/sun/jini/thread/RetryTask.html#complete()">complete</a>, <a href="../../../../com/sun/jini/thread/RetryTask.html#reset()">reset</a>, <a href="../../../../com/sun/jini/thread/RetryTask.html#run()">run</a>, <a href="../../../../com/sun/jini/thread/RetryTask.html#startTime()">startTime</a>, <a href="../../../../com/sun/jini/thread/RetryTask.html#waitFor()">waitFor</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html?is-external=true#clone()" title="class or interface in java.lang">clone</a>, <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang">equals</a>, <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html?is-external=true#finalize()" title="class or interface in java.lang">finalize</a>, <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang">getClass</a>, <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang">hashCode</a>, <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang">notify</a>, <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang">notifyAll</a>, <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html?is-external=true#toString()" title="class or interface in java.lang">toString</a>, <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang">wait</a>, <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang">wait</a>, <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html?is-external=true#wait(long, int)" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="txn">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>txn</h4>
<pre>private final&nbsp;<a href="../../../../com/sun/jini/outrigger/Txn.html" title="class in com.sun.jini.outrigger">Txn</a> txn</pre>
<div class="block">transaction being monitored</div>
</li>
</ul>
<a name="monitor">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>monitor</h4>
<pre>private final&nbsp;<a href="../../../../com/sun/jini/outrigger/TxnMonitor.html" title="class in com.sun.jini.outrigger">TxnMonitor</a> monitor</pre>
<div class="block">the monitor we were made by</div>
</li>
</ul>
<a name="queries">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>queries</h4>
<pre>private&nbsp;<a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/Map.html?is-external=true" title="class or interface in java.util">Map</a> queries</pre>
<div class="block">All the queries on the space (not queries to the transaction
 manager) waiting for <code>txn</code> to be resolved.
 <code>null</code> until we have at least one. Represented by
 <code>QueryWatcher</code> objects.</div>
</li>
</ul>
<a name="failCnt">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>failCnt</h4>
<pre>private&nbsp;int failCnt</pre>
<div class="block">count of RemoteExceptions</div>
</li>
</ul>
<a name="nextQuery">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>nextQuery</h4>
<pre>private&nbsp;long nextQuery</pre>
<div class="block">The next time we need to poll the transaction manager 
 to get <code>txn</code>'s actual state.</div>
</li>
</ul>
<a name="mustQuery">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>mustQuery</h4>
<pre>private&nbsp;boolean mustQuery</pre>
<div class="block">When we're given an opportunity to poll the transaction manager
 for the <code>txn</code>'s state, do so.</div>
</li>
</ul>
<a name="deltaT">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>deltaT</h4>
<pre>private&nbsp;long deltaT</pre>
<div class="block">next value added to <code>nextQuery</code></div>
</li>
</ul>
<a name="INITIAL_GRACE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>INITIAL_GRACE</h4>
<pre>private static final&nbsp;long INITIAL_GRACE</pre>
<div class="block">The initial grace period before the first query.</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../constant-values.html#com.sun.jini.outrigger.TxnMonitorTask.INITIAL_GRACE">Constant Field Values</a></dd></dl>
</li>
</ul>
<a name="BETWEEN_EXCEPTIONS">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>BETWEEN_EXCEPTIONS</h4>
<pre>private static final&nbsp;long BETWEEN_EXCEPTIONS</pre>
<div class="block">The retry time when we have an encountered an exception</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../constant-values.html#com.sun.jini.outrigger.TxnMonitorTask.BETWEEN_EXCEPTIONS">Constant Field Values</a></dd></dl>
</li>
</ul>
<a name="MAX_DELTA_T">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>MAX_DELTA_T</h4>
<pre>private static final&nbsp;long MAX_DELTA_T</pre>
<div class="block">The largest value that <code>deltaT</code> will reach.</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../constant-values.html#com.sun.jini.outrigger.TxnMonitorTask.MAX_DELTA_T">Constant Field Values</a></dd></dl>
</li>
</ul>
<a name="MAX_FAILURES">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>MAX_FAILURES</h4>
<pre>private static final&nbsp;int MAX_FAILURES</pre>
<div class="block">The maximum number of failures allowed in a row before we simply
 give up on the transaction and consider it aborted.</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../constant-values.html#com.sun.jini.outrigger.TxnMonitorTask.MAX_FAILURES">Constant Field Values</a></dd></dl>
</li>
</ul>
<a name="logger">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>logger</h4>
<pre>private static final&nbsp;<a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/logging/Logger.html?is-external=true" title="class or interface in java.util.logging">Logger</a> logger</pre>
<div class="block">Logger for logging transaction related information</div>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="TxnMonitorTask(com.sun.jini.outrigger.Txn, com.sun.jini.outrigger.TxnMonitor, com.sun.jini.thread.TaskManager, com.sun.jini.thread.WakeupManager)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>TxnMonitorTask</h4>
<pre>TxnMonitorTask(<a href="../../../../com/sun/jini/outrigger/Txn.html" title="class in com.sun.jini.outrigger">Txn</a>&nbsp;txn,
              <a href="../../../../com/sun/jini/outrigger/TxnMonitor.html" title="class in com.sun.jini.outrigger">TxnMonitor</a>&nbsp;monitor,
              <a href="../../../../com/sun/jini/thread/TaskManager.html" title="class in com.sun.jini.thread">TaskManager</a>&nbsp;manager,
              <a href="../../../../com/sun/jini/thread/WakeupManager.html" title="class in com.sun.jini.thread">WakeupManager</a>&nbsp;wakeupMgr)</pre>
<div class="block">Create a new TxnMonitorTask.</div>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="retryTime()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>retryTime</h4>
<pre>public&nbsp;long&nbsp;retryTime()</pre>
<div class="block">Return the time of the next query, bumping <code>deltaT</code> as
 necessary for the next iteration.  If the transaction has voted
 <code>PREPARED</code> or the manager has been giving us a
 <code>RemoteException</code>, we should retry on short times;
 otherwise we back off quickly.</div>
<dl>
<dt><strong>Overrides:</strong></dt>
<dd><code><a href="../../../../com/sun/jini/thread/RetryTask.html#retryTime()">retryTime</a></code>&nbsp;in class&nbsp;<code><a href="../../../../com/sun/jini/thread/RetryTask.html" title="class in com.sun.jini.thread">RetryTask</a></code></dd>
</dl>
</li>
</ul>
<a name="runAfter(java.util.List, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>runAfter</h4>
<pre>public&nbsp;boolean&nbsp;runAfter(<a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&nbsp;tasks,
               int&nbsp;size)</pre>
<div class="block">We can run in parallel with any task, so just return
 <CODE>false</CODE>.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../com/sun/jini/thread/TaskManager.Task.html#runAfter(java.util.List, int)">runAfter</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../com/sun/jini/thread/TaskManager.Task.html" title="interface in com.sun.jini.thread">TaskManager.Task</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>tasks</code> - the tasks to consider.  A read-only List, with all
 elements instanceof Task.</dd><dd><code>size</code> - elements with index less than size should be considered</dd></dl>
</li>
</ul>
<a name="addSibling(com.sun.jini.outrigger.Txn)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>addSibling</h4>
<pre>void&nbsp;addSibling(<a href="../../../../com/sun/jini/outrigger/Txn.html" title="class in com.sun.jini.outrigger">Txn</a>&nbsp;txn)</pre>
<div class="block">Add a ``sibling'' transaction, one that is now blocking progress
 on one of the same entries.  For example, if a client is blocked
 on a <code>read</code>, another transaction can read the same
 entry, thereby also blocking that same client.  This means that
 the transaction for the second <code>read</code> must be
 watched, too.  The list of queries for the second transaction
 might be less that the list of those in this transaction, but
 the process of figuring out the subset is too expensive, since
 we have tried to make the checking process itself cheap,
 anyway.  So we add all queries this task is currently monitoring
 to the task monitoring the second transaction.  If there are
 no queries, then the blocking occurred because of a short query
 or all the queries have expired, in which case the second transaction
 isn't blocking the way of anything currently, so this method does
 nothing.
 <p>
 Of course, in order to avoid blocking the thread that is calling
 this (which is trying to perform a <code>read</code>, after
 all), we simply add each lease in this task to the monitor's
 queue.</div>
</li>
</ul>
<a name="tryOnce()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>tryOnce</h4>
<pre>public&nbsp;boolean&nbsp;tryOnce()</pre>
<div class="block">Try to see if this transaction should be aborted.  This returns
 <code>true</code> (don't repeat the task) if it knows that the
 transaction is no longer interesting to anyone.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../com/sun/jini/thread/RetryTask.html#tryOnce()">tryOnce</a></code>&nbsp;in class&nbsp;<code><a href="../../../../com/sun/jini/thread/RetryTask.html" title="class in com.sun.jini.thread">RetryTask</a></code></dd>
</dl>
</li>
</ul>
<a name="add(com.sun.jini.outrigger.QueryWatcher)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>add</h4>
<pre>void&nbsp;add(<a href="../../../../com/sun/jini/outrigger/QueryWatcher.html" title="class in com.sun.jini.outrigger">QueryWatcher</a>&nbsp;query)</pre>
<div class="block">Add in a resource.  The lease may already be in, in which case it is
 ignored, or it may be null, in which case it was a non-leased probe
 that was blocked and we simply set <code>mustQuery</code> to
 <code>true</code>.</div>
</li>
</ul>
<a name="logUnpackingFailure(java.lang.String, java.util.logging.Level, boolean, java.lang.Throwable)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>logUnpackingFailure</h4>
<pre>private&nbsp;void&nbsp;logUnpackingFailure(<a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;exceptionDescription,
                       <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/logging/Level.html?is-external=true" title="class or interface in java.util.logging">Level</a>&nbsp;level,
                       boolean&nbsp;terminal,
                       <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang">Throwable</a>&nbsp;t)</pre>
<div class="block">Log failed unpacking attempt attempt</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/TxnMonitorTask.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/sun/jini/outrigger/TxnMonitor.ToMonitor.html" title="class in com.sun.jini.outrigger"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../com/sun/jini/outrigger/TxnState.html" title="class in com.sun.jini.outrigger"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/sun/jini/outrigger/TxnMonitorTask.html" target="_top">Frames</a></li>
<li><a href="TxnMonitorTask.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright 2007-2013, multiple authors.<br>Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0" target="child" >Apache License, Version 2.0</a>, see the <a href="../../../../doc-files/NOTICE" target="child" >NOTICE</a> file for attributions.</small></p>
</body>
</html>
